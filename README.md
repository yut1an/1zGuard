# 1zGuard
 
1zGuard 是一个面向 Windows 的“自定义防护”工具：通过规则拦截文件/注册表/进程等敏感操作，并在需要时弹出询问窗口让你选择“允许 / 阻止”。
 
## 截图
 
- **主界面**：
![home](../image/home.png)
- **添加/编辑规则**：
![rule](../image/add.png)
- **询问弹窗（Ask）**：   
![ask](../image/ask.png)
 
## 功能概览
 
- **自定义规则**：按“发起程序 + 保护对象 + 动作”组合进行匹配
- **三种处理方式**：`询问我(Ask) / 自动允许(Allow) / 自动阻止(Block)`
- **全局防护开关**：一键启用/暂停拦截
- **询问弹窗**：只在规则处理方式为“询问我”时触发
 
## 快速开始
 
1) **安装并运行**
 
- 运行 1zGuard.exe
- 建议 **以管理员权限运行**（驱动加载/服务管理/部分系统访问需要权限）
 
2) **首次启动：完成驱动准备**
 
- 如果提示需要开启测试签名模式（testsigning），按提示操作并重启
- 启动后会自动加载/启动驱动并建立通信
 
3) **开启防护**
 
- 在主界面打开“防护开关”
 
4) **添加规则**
 
- 选择“发起程序”（可使用 `*` 等通配思路）
- 添加保护对象（文件 / 注册表 / 执行）并勾选动作（创建/读取/修改/删除，执行类为执行）
- 选择处理方式：
  - `询问我`：触发弹窗
  - `自动允许`：命中后直接放行
  - `自动阻止`：命中后直接拦截
- 保存
 
## 规则与处理方式
 
- **询问我（Ask）**
  - 命中后弹出询问窗口
  - 由你手动选择“允许/阻止”
 
- **自动允许（Allow）**
  - 命中后直接放行，不弹窗
 
- **自动阻止（Block）**
  - 命中后直接拦截，不弹窗
 
## 用户决策：one by one（当前实现思路）
 
你现在的实现目标是“**单窗口、逐个决策**”，并且为了避免系统层面长期等待，做了“防堆积/防弹窗轰炸”的处理：
 
- **单窗口**：询问弹窗使用独立窗口显示，同一时刻只展示一条请求。
- **单请求**：当前弹窗未处理时，如果又来了新的询问：
  - 会对“上一条未处理请求”做**默认阻止**并立即回传
  - 界面切换为展示最新的一条
- **超时兜底**：用户一直不点，倒计时结束会自动按“阻止”处理，确保不会无限等待。

## 注意事项
 
- 系统级拦截可能影响稳定性，建议先在测试环境验证规则。
- 对系统关键路径使用“询问我(Ask)”会频繁弹窗，建议更倾向使用“自动允许/自动阻止”配合更精确的规则.
